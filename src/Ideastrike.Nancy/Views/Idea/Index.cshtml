@inherits Nancy.ViewEngines.Razor.NancyRazorViewBase
@{
    Layout = "Views/Shared/Layout.cshtml";
}
@{ var idea = Model.Idea; }
<div class="pull-right">
    <div class="sidebox">
        <form>
        <!-- Yes, I know this isn't going to be correct -->
    <h3 id="votecount">@idea.Votes.Count</h3>
        votes<br />
        <br />
    <input type="button" value="vote" data-has-voted="@Model.UserHasVoted" onclick="vote()" />
        </form>
    </div>
    <div class="sidebox">
        <div>
            <a href="https://twitter.com/share" class="twitter-share-button" data-text="Idea: @Model.Title - @Model.Description" data-hashtags="ideastrike">Tweet this idea!</a>
        </div>
        <div id="fb-root"></div><div class="fb-like" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true"></div>
    </div>
</div>

<h1>@idea.Title</h1>
@idea.Description

<hr />
@if (idea.Features.Count > 0)
{ 
    <h4>Features</h4>
    <ul id="features">
        @foreach (var a in idea.Features)
        {
            <!-- TODO: Markdownify this text? -->
                <sub>@a.Time</sub>
        }
    </ul>
    <!-- TODO: comment on a feature -->
}
else
{
    <h4>
        No feature requests yet, add the first one!</h4>
}
<form action="/idea/@idea.Id/feature" method="POST">
<div>
    <label for="feature">
    <label for="feature">feature request</label>
    <!--  TODO: can we hook in some anti-forgery bits? -->
    <input type="text" id="feature" name="feature" ></input><br /><br />
    <br />
    <input type="hidden" name="userId" value="@Model.UserId"/>
    <label for="submit">
    </label>
    <input type="submit" />
</div>
</form>
<hr />
@if (idea.Activities.Count > 0)
{ 
    <h4>
        Activity</h4>
    <ul id="comments">
        @foreach (var a in idea.Activities)
        {
            <li>@a.Text<br /><sub>@a.Time</sub> </li>
        }
    </ul>
    <!-- TODO: reply to a comment -->
}
else
{
    <h4>No activity yet, add the first comment!</h4>
}
<form action="/comment/@idea.Id/add" method="POST">
    <div>
        <label for="comment">leave a comment</label>
        <textarea id="comment" name="comment"></textarea><br />
        <input type="hidden" name="userId" value="@Model.UserId"/>
        <br />
        <label for="submit"></label>
        
        <input type="submit" />
    </div>
</form>



@section PageScript {
    <script>
        function vote() {
            $.ajax({
                url: "/idea/@idea.Id/vote/9",
                context: document.body,
                success: function (data) {
                    /* This is really nasty, surely there is a better way? */
                    $("#votecount").replaceWith("<h3 id='votecount'>" + data.NewVotes + "</h3>");
                }
            });
        }

        !function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (!d.getElementById(id)) {
                js = d.createElement(s);
                js.id = id;
                js.src = "//platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);
            }
        } (document, "script", "twitter-wjs");

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
            fjs.parentNode.insertBefore(js, fjs);
        } (document, 'script', 'facebook-jssdk'));
    </script>
}
